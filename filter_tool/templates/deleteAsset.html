{% extends "filter/base.html" %}

{% load bootstrap3 %}

{% block LaunchButton %}
<div><button class="btn btn-primary pull-right" style="margin-top:10px;" onClick="window.location.href='{% url 'Launch' %}'">Launch Filters to App</button></div>
{% endblock %}

{% block ChangeFilterButton %}
<div><button class="btn btn-primary pull-right" style="margin-top:10px;" onClick="window.location.href='{% url 'Filter2 Upload' %}'">After Mrr Filters</button></div>
{% endblock %}

{% block pagecontent %}


<form action="/filters/assetfortype/" method="get" class="form" style="margin-top:20px;">
    {% csrf_token %}
    {% bootstrap_form asset_form %}
    {{ error }}
    <input type="submit" value="Get Asset" />
</form>

<div id="bootstrapTagsInputForm" method="post" class="form-horizontal">
    <div class="form-group">
        <label class="col-xs-3 control-label">Order</label>
        <div style="margin:0 0 1.2em">
            <textarea id="order"></textarea>
        </div>
    </div>

</div>

<div id = "deleteForm" class="form-horizontal">
    <div class="form-group">
        <label class="col-xs-3 control-label">AssetName</label>
        <div style="margin:0 0 1.2em">
            <input id = "assetName" type="text" placeholder="Enter AssetName" required>
        </div>
    </div>

    <div class="form-group">
        <div class="col-xs-5 col-xs-offset-3">
            <button type="submit" class="btn btn-default" id="delete">Delete</button>
        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
</script>
<script>
$(document).ready(function () {
	console.log("Mrr");

    String.prototype.replaceAll = function (find, replace) {
        var str = this;
        return str.replace(new RegExp(find, 'g'), replace);
    };
    var data = "{{data | join:','}}";
    var type = 0;
    if("{{type}}"){
        type = "{{type}}";
    }
    var initialLength = 0;
    if(data == ''){
        $('#bootstrapTagsInputForm').hide();
    }
    else{
        data = data.toString().split(',');
        for(var i = 0; i < data.length; i++){
            data[i] = decodeURI(data[i]);
            data[i] = data[i].replaceAll("&#39;","'");
            data[i] = data[i].replaceAll("#39;","");
            data[i] = data[i].replaceAll("&amp;","&");
            data[i] = data[i].replaceAll('amp;','');
            var index = data.indexOf(data[i]);
            if(index < i){
                data.splice(i,1);
                i--;
            }
        }
        initialLength = data.length;
    }
    if(!initialLength){
        $('#bootstrapTagsInputForm').hide();
    }

    $('#order').tagEditor({
        initialTags: data,
        delimiter: ', ', /* space and comma */
        placeholder: 'Enter tags ...',
        forceLowercase:false,
        removeDuplicates : true,
        sortable:true,
        beforeTagDelete: function(field, editor, tags, val) {
            alert(" You can't remove any tag. Just reorder them");
            return false;
        }
    });



	 $("#delete").click(function(){
       
       var assetName = $('#assetName').val();

        console.log("assetName = ", assetName);
        $.ajax({
            url:"/filters/deleteasset/?assetName="+assetName,
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            method:"DELETE",
            error:function(error){
                alert(" Error = %j",error);
            },
            success: function (response) {
                if(!response.error){
                    alert(" Asset : " + assetName + " deleted successfully");
                }
                else{
                    alert(" Error = %j",response.error);
                }
            }
        })
    })


})
</script>

{% endblock %}